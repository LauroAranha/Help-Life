<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="img/hl.png">
    <link rel="stylesheet" href="styleform.css">
    <title>Help Life</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" />
</head>

<body>
    <h1 id="bem-vindo">
        <div class="account-details"></div>
    </h1>
    <div class="box">
        <section>
            <form action="">
                <p>Editar informações</p>
                <label for="#">Insira seu email atual</label>
                <input type="text" id="emailAtual" required />
                <label for="#">Insira sua senha atual</label>
                <input type="password" id="passwordAtual" required />
                <i class="bi bi-eye-slash" id="togglePassword"></i>
                <label for="#">Insira seu novo nome</label>
                <input type="text" id="name" required />
                <label for="#">Insira seu novo email</label>
                <input type="email" id="email" required />

                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <button id="update" class="btn yellow darken-2 z-depth-0">Salvar</button>
                    <abbr title="continuar para login">
                    </abbr>
                    </a>
                </div>
            </form>
        </section>
    </div>

    <h1 id="bem-vindo">
        <div class="account-details"></div>
    </h1>
    <script>
        function myFunction(x) { x.classList.toggle("change"); }
    </script>
    <script src="https://code.jquery.com/jquery-3.1.0.slim.js"></script>
    <!-- GUIDE LIST -->
    <div class="container" style="margin-top: 40px;">
        <ul class="collapsible z-depth-0 guides" style="border: none;">

        </ul>
    </div>
    <script>
        const togglePassword = document.querySelector('#togglePassword');
        const password = document.querySelector('#passwordAtual');
        togglePassword.addEventListener('click', function (e) {
            const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
            password.setAttribute('type', type);
            this.classList.toggle('bi-eye');
        });
    </script>

    <script src="https://www.gstatic.com/firebasejs/5.6.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.6.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.6.0/firebase-firestore.js"></script>
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDBXIkjF58K7SIwmbb5oinqhPmEFVnfPLo",
            authDomain: "help-life-96b28.firebaseapp.com",
            databaseURL: "https://help-life-96b28-default-rtdb.firebaseio.com",
            projectId: "help-life-96b28",
            storageBucket: "help-life-96b28.appspot.com",
            messagingSenderId: "333592759358",
            appId: "1:333592759358:web:1df02da30a91fd1c35956f",
        };
        firebase.initializeApp(firebaseConfig);

        // make auth and firestore references
        const auth = firebase.auth();
        const db = firebase.firestore();

        // update firestore settings
        db.settings({ timestampsInSnapshots: true });
    </script>
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>


    <script>
        // update user

        document.getElementById("update").onclick = function () {
            event.preventDefault();

            // passar os dados de acesso (email e senha) para autorizar a edição
            var emailAtual = document.getElementById("emailAtual").value;
            var passwordAtual = document.getElementById("passwordAtual").value;

            var newEmail = document.getElementById("email").value;
            var newName = document.getElementById("name").value;

            firebase.auth()
                .signInWithEmailAndPassword(emailAtual, passwordAtual)
                .then(function (userCredential) {
                    userCredential.user.updateEmail(newEmail)
                })

            var db = firebase.firestore();
            var ag = db.collection("users").where("email", "==", emailAtual);

            ag.get()
                .then((querySnapshot) => {
                    querySnapshot.forEach((doc) => {
                        var dados = db.collection("users").doc(doc.id);
                        return dados.update({
                            email: newEmail,
                            nome: newName
                        })
                    })
                    alert("Dados atualizados com sucesso! Retorne a página anterior para que as mudanças sejam efetivadas!");
                })

        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="../../js/loginjs/loginUser.js"></script>
    <script src="../../loggedUsuVol/scripts/index.js"></script>

</body>

</html>